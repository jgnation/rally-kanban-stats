<!DOCTYPE html>
<html>
<head>
    <title>exclusions</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.Loader.setConfig({enabled:!0,disableCaching:!0,paths:{"Ext.ux":"ux"}}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:{html:'<a href="https://help.rallydev.com/apps/2.0rc3/doc/">App SDK 2.0rc3 Docs</a>'},launch:function(){this.excludedDates=[],this._createContainers(),this._createDateFields(),this._createMultiDateCalendar()},_createContainers:function(){this.topContainer=Ext.create("Ext.container.Container",{title:"Top",flex:1,layout:{type:"hbox",align:"stretch"}}),this.add(this.topContainer),this.topLeftContainer=Ext.create("Ext.container.Container",{title:"TopLeft",flex:.3,layout:{type:"vbox",align:"stretch"}}),this.topContainer.add(this.topLeftContainer),this.topCenterContainer=Ext.create("Ext.container.Container",{title:"TopCenter",flex:.2,layout:{type:"vbox",align:"stretch"}}),this.topContainer.add(this.topCenterContainer),this.topRightContainer=Ext.create("Ext.container.Container",{title:"TopRight",flex:.3,layout:{type:"vbox",align:"stretch"}}),this.topContainer.add(this.topRightContainer),this.bottomContainer=Ext.create("Ext.container.Container",{title:"Bottom",flex:2,layout:{align:"stretch"}}),this.add(this.bottomContainer)},_createDateFields:function(){var start=Ext.create("Ext.Container",{items:[{xtype:"rallydatefield",fieldLabel:"Start Date",value:this.startDate=new Date,listeners:{change:function(start,newValue,oldValue,eOpts){this.startDate=newValue},scope:this}}],renderTo:Ext.getBody().dom}),end=Ext.create("Ext.Container",{items:[{xtype:"rallydatefield",fieldLabel:"End Date",value:this.endDate=new Date,listeners:{change:function(start,newValue,oldValue,eOpts){this.endDate=newValue},scope:this}}],renderTo:Ext.getBody().dom});this.topLeftContainer.add(start),this.topLeftContainer.add(end)},_createMultiDateCalendar:function(){var calendar=Ext.create("MultiDateCalendarPanel"),panel=calendar._create(this);this.topLeftContainer.add(panel)},_runReport:function(){var sDate=Rally.util.DateTime.toIsoString(this.startDate),eDate=Rally.util.DateTime.toIsoString(this.endDate);this._loadData(sDate,eDate)},_loadData:function(startDate,endDate){var storeFilters=[{property:"ScheduleState",operation:"=",value:"Accepted"},{property:"DirectChildrenCount",operation:"=",value:"0"},{property:"AcceptedDate",operator:">=",value:startDate},{property:"AcceptedDate",operator:"<=",value:endDate}];if(this.myStore)this.myStore.setFilter(storeFilters),this.myStore.load();else{var store=Ext.create("MainStore");this.myStore=store._create(this,storeFilters)}},_loadGrid:function(myStoryStore,records){if(this.customGridStore)this.customGridStore.loadRawData(records);else{this.customGridStore=Ext.create("Rally.data.custom.Store",{data:records});var mainGrid=Ext.create("MainGrid");this.myGrid=mainGrid._create(this),this.bottomContainer.add(this.myGrid)}},_createChart:function(records){var chart=Ext.create("Chart"),data=chart._recordsToChartData(records);this.chartStore?this.chartStore.loadRawData(data):(this.chartStore=Ext.create("Ext.data.JsonStore",{fields:["name","data"],data:data}),this.chart=chart._create(this),this.topRightContainer.add(this.chart)),this._createCenterGrid(data,records)},_createCenterGrid:function(data,records){var centerGrid=Ext.create("CenterGrid");centerGrid._addTotalStories(data),centerGrid._addAverageDays(data,records),this.centerGridStore?this.centerGridStore.loadRawData(data):(this.centerGridStore=Ext.create("Rally.data.custom.Store",{fields:["name","data"],data:data}),this.centerGrid=centerGrid._create(this),this.topCenterContainer.add(this.centerGrid))}});
                Ext.define("Ext.ux.form.field.MultiValue",{isMultiValued:!0,multiValue:!1,valueSeparatorRE:/[;,]\s*/,rangeSeparatorRE:/\s*-\s*/,valuePatternRE:/\d+/,displayValueSeparator:", ",displayRangeSeparator:"-",submitValueSeparator:";",submitRangeSeparator:"-",constructor:function(config){var me=this,config=config||{};Ext.apply(me,config),me.regex=me.multiValue?me.initMultiRegex():me.initSingleRegex(),me.callParent(arguments)},initSingleRegex:function(){var me=this,value;return value=me.valueRegex(),RegExp("^"+value+"$")},initMultiRegex:function(){var me=this,value,vsep,rsep,range,valueOrRange;return value=me.valueRegex(),me.rangeSeparatorRE=RegExp(me.rangeSeparatorRE),me.valueSeparatorRE=RegExp(me.valueSeparatorRE),rsep=me.rangeSeparatorRE.source,vsep=me.valueSeparatorRE.source,range=value+rsep+value,valueOrRange="("+value+"|"+range+")",RegExp("^("+valueOrRange+")"+"("+vsep+valueOrRange+")*"+"$")},valueRegex:function(){var me=this,vp;return me.valuePatternRE=vp=RegExp(me.valuePatternRE),vp.source},formatSubmitValue:function(value){return value},formatSubmitRange:function(range,rsep){var me=this,start,end;return start=me.formatSubmitValue(range[0]),end=me.formatSubmitValue(range[1]),start+rsep+end},formatSubmit:function(values,rsep,vsep){var me=this,multi=me.multiValue,valsep=me.valueSeparatorRE,ransep=me.rangeSeparatorRE,items,isStr,doesMatch;items=me.splitValues(values,valsep);for(var i=0,l=items.length;l>i;i++){var item=items[i],vr;vr=me.splitValues(item,ransep),items[i]=vr.length>1?me.formatSubmitRange(vr,rsep||me.submitRangeSeparator):me.formatSubmitValue(vr)}return values=items.join(vsep||me.submitValueSeparator)},splitValues:function(values,regex){var me=this;return me.multiValue&&Ext.isString(values)&&""!==regex.source&&values.match(regex)?values.split(regex):[values]},formatDisplayValue:function(value){return Ext.isString(value)?value:""+value},formatDisplayRange:function(range,rsep){var me=this,start,end;return start=me.formatDisplayValue(range[0]),end=me.formatDisplayValue(range[1]),start+rsep+end},formatDisplay:function(values,rsep,vsep){var me=this,multi=me.multiValue,results=[];if(!multi)return me.formatDisplayValue(values[0]);for(var i=0,l=values.length;l>i;i++){var value=values[i];Ext.isArray(value)?results.push(me.formatDisplayRange(value,rsep||me.displayRangeSeparator)):results.push(me.formatDisplayValue(value))}return results.join(vsep||me.displayValueSeparator)}});
                Ext.define("Ext.ux.picker.MultiDate",{extend:"Ext.picker.Date",alias:"widget.multidatepicker",alternateClassName:["Ext.picker.MultiDate","Ext.MultiDatePicker"],renderTpl:['<div class="{cls}" id="{id}-innerEl" role="grid">','<div role="presentation" class="{baseCls}-header">','<a id="{id}-prevEl" class="{baseCls}-prev {baseCls}-arrow" href="#" role="button" title="{prevText}" hidefocus="on" ></a>','<div class="{baseCls}-month" id="{id}-middleBtnEl">{%this.renderMonthBtn(values, out)%}</div>','<a id="{id}-nextEl" class="{baseCls}-next {baseCls}-arrow" href="#" role="button" title="{nextText}" hidefocus="on" ></a>',"</div>",'<table id="{id}-eventEl" class="u{baseCls}-inner" cellspacing="0" role="presentation">','<thead role="presentation"><tr role="presentation">','<tpl for="dayNames">','<th role="columnheader" title="{.}"><span>{.:this.firstInitial}</span></th>',"</tpl>","</tr></thead>",'<tbody role="presentation"><tr role="presentation">','<tpl for="days">',"{#:this.isEndOfWeek}",'<td role="gridcell" id="{[Ext.id()]}">','<a role="presentation" href="#" hidefocus="on" class="{parent.baseCls}-date" tabIndex="1">','<em role="presentation"><span role="presentation"></span></em>',"</a>","</td>","</tpl>","</tr></tbody>","</table>",'<div id="{id}-footerEl" role="presentation" class="{baseCls}-footer">','<tpl if="this.showToday">',"{%this.renderTodayBtn(values, out)%}","<tpl else>","{%this.renderOkBtn(values, out)%}","{%this.renderCancelBtn(values, out)%}","{%this.renderClearBtn(values, out)%}","</tpl>","</div>","</div>",{firstInitial:function(value){return Ext.picker.Date.prototype.getDayInitial(value)},isEndOfWeek:function(value){value--;var end=0===value%7&&0!==value;return end?'</tr><tr role="row">':""},renderTodayBtn:function(values,out){Ext.DomHelper.generateMarkup(values.$comp.todayBtn.getRenderTree(),out)},renderOkBtn:function(values,out){Ext.DomHelper.generateMarkup(values.$comp.okBtn.getRenderTree(),out)},renderCancelBtn:function(values,out){Ext.DomHelper.generateMarkup(values.$comp.cancelBtn.getRenderTree(),out)},renderClearBtn:function(values,out){Ext.DomHelper.generateMarkup(values.$comp.clearBtn.getRenderTree(),out)},renderMonthBtn:function(values,out){Ext.DomHelper.generateMarkup(values.$comp.monthBtn.getRenderTree(),out)}}],nextText:Ext.isMac?"Next Month (&#x2318;&#x2192;)":"Next Month (Control+Right)",prevText:Ext.isMac?"Previous Month (&#x2318&#x2190;)":"Previous Month (Control+Left)",monthYearText:Ext.isMac?"Choose a month (&#x2318 + &#x2191;/&#x2193; to move years)":"Choose a month (Control+Up/Down to move years)",okText:"OK",okTooltip:Ext.isMac?"Confirm selection (⏎)":"Confirm selection (Enter)",cancelText:"Cancel",cancelTooltip:Ext.isMac?"Cancel selection (⎋)":"Cancel selection (Escape)",clearText:"Clear",clearTooltip:Ext.isMac?"Clear selection (⌘⌫)":"Clear selection (Ctrl+Backspace)",workDays:[1,2,3,4,5],showToday:!1,initComponent:function(){var me=this,wd=me.workDays;if(me.callParent(arguments),me.activeCls="ux-datepicker-active",me.selDates=[],wd&&Ext.isArray(wd)){for(var hash={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1},i=0,l=wd.length;l>i;i++)hash[wd[i]]=!0;me.workDaysHash=hash}else me.workDaysHash={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0}},beforeRender:function(){var me=this;if(me.callParent(arguments),!me.showToday){Ext.destroy(me.todayBtn);var layout=me.getComponentLayout();me.okBtn=new Ext.button.Button({ownerCt:me,ownerLayout:layout,text:me.okText,tooltip:me.okTooltip,handler:me.onOkButton,scope:me}),me.cancelBtn=new Ext.button.Button({ownerCt:me,ownerLayout:layout,text:me.cancelText,tooltip:me.cancelTooltip,handler:me.onCancelButton,scope:me}),me.clearBtn=new Ext.button.Button({ownerCt:me,ownerLayout:layout,text:me.clearText,tooltip:me.clearTooltip,handler:me.clearSelection,scope:me})}},finishRenderChildren:function(){var me=this;me.callParent(),me.showToday||(me.okBtn.finishRender(),me.cancelBtn.finishRender(),me.clearBtn.finishRender())},initEvents:function(){var me=this,evEl=me.eventEl;me.callParent(arguments),evEl.addKeyListener(Ext.EventObject.ENTER,me.onOkButton,me),evEl.addKeyListener(Ext.EventObject.ESC,me.onCancelButton,me),evEl.addKeyListener(Ext.EventObject.SPACE,me.handleSpacebar,me),evEl.addKeyListener({key:Ext.EventObject.BACKSPACE,ctrl:!0},me.clearSelection,me)},setValue:function(values){function getClearTime(d){return Ext.Date.clearTime(d).getTime()}var me=this;me.selDates=Ext.isArray(values)?Ext.Array.map(values,getClearTime):[getClearTime(values)],me.update(values)},getValue:function(){var me=this;return Ext.Array.map(me.selDates,function(t){return new Date(t)})},onOkButton:function(){var me=this,handler=me.handler;if(!me.disabled){var value=me.getValue();me.fireEvent("select",me,value),handler&&handler.call(me.scope||me,me,value),me.onSelect(),me.clearSelection()}},onCancelButton:function(){var me=this;me.clearSelection(),me.pickerField.collapse()},clearSelection:function(){var me=this,cells=me.cells,aCls=me.activeCls,sCls=me.selectedCls;me.selDates=[],me.rangeSelection=!1,cells.removeCls(aCls),cells.removeCls(sCls),me.update(Ext.Date.clearTime(new Date))},handleDateClick:function(event,target){var me=this,selDates=me.selDates,el,dv,dt;event.stopEvent(),el=Ext.fly(target.parentElement),dv=target.dateValue,event.shiftKey&&!event.ctrlKey?dt=me.toggleWeekSelection(el):event.ctrlKey?me.rangeSelection?(dt=me.selectRange(me.rangeSelection,dv,event.shiftKey),me.rangeSelection=!1):(me.rangeSelection=dv,dt=me.toggleDateSelection(el,!0,dv)):dt=me.toggleDateSelection(el,void 0,dv),dt&&me.update(selDates),me.update(new Date(dv))},handleSpacebar:function(keycode,event){var me=this,selDates=me.selDates,cells=me.cells,activeDate,activeCell,activeIdx,dt;activeDate=me.activeDate.getTime(),activeIdx=me.getCellIndex(activeDate),-1!=activeIdx&&(activeCell=cells.item(activeIdx),dt=event.shiftKey?me.toggleWeekSelection(activeCell,activeIdx):me.toggleDateSelection(activeCell,void 0,activeDate),dt&&me.update(selDates))},getCellIndex:function(value){var me=this,cells=me.cells,index;return cells.each(function(el,c,idx){index||el.down("a").getAttribute("dateValue")!==value||(index=idx)}),void 0===index?-1:index},selectRange:function(start,end,workWeek){var me=this,selDates=me.selDates,wdHash=me.workDaysHash,add=Ext.Date.add,DAY=Ext.Date.DAY,contains=Ext.Array.contains,include=Ext.Array.include,tmp,dt,dv;for(start>end&&(tmp=start,start=end,end=tmp),Ext.Array.remove(selDates,new Date(start).getTime()),dt=new Date(start),dv=dt.getTime();end>=dv;dt=add(dt,DAY,1),dv=dt.getTime())(!workWeek||wdHash[dt.getDay()])&&include(selDates,dv);return!0},toggleWeekSelection:function(el,index){var me=this,cells=me.cells,selectedCls=me.selectedCls,disabledCls=me.disabledCellCls,workDays=me.workDays,selected,dayNo,firstDay;if(void 0===index&&(index=me.getCellIndex(el.down("a").getAttribute("dateValue"))),!me.disabled&&!el.hasCls(disabledCls)&&(selected=el.hasCls(selectedCls),dayNo=index%7,firstDay=index-dayNo,Ext.Array.contains(workDays,dayNo)))for(var i=firstDay+workDays[0],l=firstDay+workDays[workDays.length-1];l>=i;i++)me.toggleDateSelection(cells.item(i),!selected);return!0},toggleDateSelection:function(el,state,dv){var me=this,selDates=me.selDates,selectedCls=me.selectedCls,disabledCls=me.disabledCellCls,selected,dv;return void 0===dv&&(dv=el.down("a").getAttribute("dateValue")),me.disabled||el.hasCls(disabledCls)||!dv?void 0:(selected=void 0!==state?!state:el.hasCls(selectedCls),selected?Ext.Array.remove(selDates,dv):Ext.Array.include(selDates,dv),el)},selectedUpdate:function(dates,active){var me=this,cells=me.cells,selectedCls=me.selectedCls,activeCls=me.activeCls,visible,cancelFocus;visible=me.isVisible(),cancelFocus=!me.focusOnSelect,cells.each(function(el){var picker=this,dv;el.removeCls([activeCls,selectedCls]),dv=el.down("a").getAttribute("dateValue"),dv===active&&(picker.getEl().set({"aria-activedescendant":el.id}),el.addCls(activeCls),visible&&!cancelFocus&&Ext.fly(el.down("a")).focus(50)),Ext.Array.contains(dates,dv)&&el.addCls(selectedCls)},me)},update:function(dates,forceRefresh){var me=this,selDates,active=me.activeDate,newActive;if(Ext.isArray(dates)&&(me.selDates=dates),selDates=me.selDates||[],newActive=Ext.isDate(dates)?dates:active,me.rendered){var am=active&&active.getMonth(),ay=active&&active.getFullYear(),nm=newActive&&newActive.getMonth(),ny=newActive&&newActive.getFullYear();me.activeDate=newActive,forceRefresh||am!=nm||ay!=ny?(me.fullUpdate(newActive,active),me.selectedUpdate(selDates,newActive.getTime())):me.selectedUpdate(selDates,newActive.getTime())}return me},beforeDestroy:function(){var me=this;me.rendered&&(Ext.destroy(me.okBtn,me.cancelBtn,me.clearBtn),delete me.selDates),me.callParent(arguments)}});
                Ext.define("Ext.ux.form.field.MultiDate",{extend:"Ext.form.field.Date",alias:"widget.multidatefield",alternateClassName:["Ext.form.field.MultiDate","Ext.form.MultiDateField","Ext.form.MultiDate"],requires:["Ext.ux.picker.MultiDate"],mixins:{multivalue:"Ext.ux.form.field.MultiValue"},okText:"OK",cancelText:"Cancel",clearText:"Clear",multiDisabledText:"Multiple dates are not allowed",invalidRangeText:"{0} is not a valid date range",invalidRangeEndsText:"{0} is invalid: start date must be earlier than end date",workDays:[1,2,3,4,5],altFormats:"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m/d|n/j",initComponent:function(){var me=this;me.callParent(arguments),me.multiValue&&(me.showToday=!1)},initValue:function(){var me=this,value=me.value;if(value&&Ext.isString(value))me.setRawValue(value);else{if(!Ext.isDate(value))return;me.setRawValue(me.formatDisplayValue(value))}me.validate()},setValue:function(value,isSubmit){var me=this;isSubmit?me.setSubmitValue(value):me.callParent([value])},setSubmitValue:function(value){var me=this,fmt=me.submitFormat,vsep,rsep,values,collapsed,text;vsep=new XRegExp(me.submitValueSeparator),rsep=new XRegExp(me.submitRangeSeparator),values=me.expandValues(value,fmt,vsep,rsep),values&&values.length?(collapsed=me.collapseRange(values),text=me.formatDisplay(collapsed),me.setRawValue(text)):me.setRawValue("")},getSubmitValue:function(){var me=this,values;return values=me.getRawValue(),me.formatSubmit(values)},createPicker:function(){var me=this,format=Ext.String.format;return me.multiValue?Ext.create("Ext.picker.MultiDate",{pickerField:me,ownerCt:me.ownerCt,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:me.minValue,maxDate:me.maxValue,disabledDatesRE:me.disabledDatesRE,disabledDatesText:me.disabledDatesText,disabledDays:me.disabledDays,disabledDaysText:me.disabledDaysText,format:me.format,showToday:me.showToday,startDay:me.startDay,okText:me.okText,cancelText:me.cancelText,clearText:me.clearText,workDays:Ext.Array.sort(me.workDays,function(a,b){return a-b}),minText:format(me.minText,me.formatDate(me.minValue)),maxText:format(me.maxText,me.formatDate(me.maxValue)),listeners:{scope:me,select:me.onSelect}}):me.callParent(arguments)},getErrors:function(values){var me=this,multi=me.multiValue,vsep=me.valueSeparatorRE,rsep=me.rangeSeparatorRE,errors=[],matches,range,isValid,dt;if(null===values||1>values.length)return me.allowBlank||errors.push(me.blankText),errors;matches=me.splitValues(values,vsep),!multi&&matches.length>1&&errors.push(me.multiDisabledText);for(var i=0,l=matches.length;l>i;i++){var match=matches[i];dt=me.parseDate(match),Ext.isDate(dt)?isValid=me.validateDate(match):rsep.test(match)?(range=me.splitValues(match,rsep),!multi&&range.length>1&&errors.push(me.multiDisabledText),isValid=me.validateRange(range)):isValid=Ext.String.format(me.invalidText,match,me.format),isValid!==!0&&errors.push(isValid)}return errors},splitValues:function(values,regex){var me=this;return Ext.isString(values)&&""!==regex.source&&values.match(regex)?values.split(regex):[values]},onExpand:function(){var me=this,text,values;return me.multiValue?(text=me.getRawValue(),me.isValid()?(values=me.expandValues(text),me.picker.setValue(values)):""===text&&me.clearInvalid(),void 0):me.callParent(arguments)},onSelect:function(picker,dates){var me=this,collapsed,text;return me.multiValue?(collapsed=me.collapseRange(dates),text=me.formatDisplay(collapsed),me.setRawValue(text),me.fireEvent("select",me,text),me.collapse(),void 0):me.callParent(arguments)},parseDate:function(value,format){var me=this,dt;return format&&(dt=me.safeParse(value,format))?dt:me.callParent([value])},validateDate:function(value){var me=this,dt;return dt=me.parseDate(value),Ext.isDate(dt)||Ext.String.format(me.invalidText,value,me.format)},validateRange:function(range){var me=this,rsep=me.displayRangeSeparator,isDate=Ext.isDate,getElapsed=Ext.Date.getElapsed,format=Ext.String.format,start,end,isValid=!1;try{start=me.parseDate(range[0]),end=me.parseDate(range[1]),isValid=!!(isDate(start)&&isDate(end)&&start.getTime()<=end.getTime())}catch(e){}return isDate(start)&&isDate(end)?start.getTime()>end.getTime()?format(me.invalidRangeEndsText,me.formatDisplayRange(range,rsep)):(isValid=me.validateDate(range[0]))!==!0?isValid:(isValid=me.validateDate(range[1]))!==!0?isValid:!0:format(me.invalidRangeText,range[0]+rsep+range[1])},formatSubmit:function(values,rsep,vsep){var me=this,multi=me.multiValue,valsep=me.valueSeparatorRE,ransep=me.rangeSeparatorRE,items,isStr,doesMatch,dt;items=me.splitValues(values,valsep);for(var i=0,l=items.length;l>i;i++){var item=items[i],vr;Ext.isDate(me.parseDate(item))?items[i]=me.formatSubmitValue(item):(vr=me.splitValues(item,ransep),items[i]=vr.length>1?me.formatSubmitRange(vr,rsep||me.submitRangeSeparator):me.formatSubmitValue(vr))}return values=items.join(vsep||me.submitValueSeparator)},formatSubmitValue:function(value){var me=this,fmt=me.submitFormat||me.format,dt,res;try{dt=Ext.Date.clearTime(me.parseDate(value)),res=Ext.Date.format(dt,fmt)}catch(e){}return Ext.isString(res)?res:""},formatDisplayValue:function(value){var me=this,fmt=me.format,dt,res;try{res=Ext.Date.format(value,fmt)}catch(e){}return Ext.isString(res)?res:""},expandValues:function(text,format,vSeparator,rSeparator){var me=this,vsep=vSeparator||me.valueSeparatorRE,rsep=rSeparator||me.rangeSeparatorRE,values,dt,result=[];if(""===text||null===text)return[];values=me.splitValues(text,vsep);for(var i=0,l=values.length;l>i;i++){var value=values[i];if(dt=me.parseDate(value,format),Ext.isDate(dt))result.push(dt);else{var range=me.splitValues(value,rsep);result=[].concat(result,range.length>1?me.expandRange(range,format):me.parseDate(range[0]))}}return result},expandRange:function(range,format){var me=this,start,end,result=[];if(start=me.parseDate(range[0],format),end=me.parseDate(range[1],format),!Ext.isDate(start)||!Ext.isDate(end)||0>Ext.Date.getElapsed(start,end))return[];dt=start;for(var dt=start;end>=dt;dt=Ext.Date.add(dt,Ext.Date.DAY,1))result.push(dt);return result},collapseRange:function(data){var me=this,range=Ext.clone(data),first,last,result=[];if(Ext.isEmpty(data))return result;range.sort(function(a,b){return a.getTime()-b.getTime()});for(var i=0,l=range.length;l>i;i++){var item=range[i];void 0!==first?me.nextInRange(last,item)?last=item:me.equalValues(first,last)?(result.push(first),first=last=item):(result.push([first,last]),first=last=item):first=last=item}return me.equalValues(first,last)?result.push(first):result.push([first,last]),result},nextInRange:function(first,last){var dt;return dt=Ext.Date.add(first,Ext.Date.DAY,1),!(dt.getTime()!==last.getTime())},equalValues:function(first,last){return first.getTime()===last.getTime()}});
                Ext.define("CenterGrid",{_addTotalStories:function(data){var totalStories=_.reduce(data,function(sum,el){return sum+el.data},0);data.push({name:"Total Stories Completed",data:totalStories})},_addAverageDays:function(data,records){var totalDaysExclusions=_.reduce(records,function(sum,el){return sum+el.DaysInProgressExclusions},0),average=totalDaysExclusions/records.length,averageRounded=Math.round(100*average)/100;data.push({name:"Average Number of Days In Progress",data:averageRounded})},_create:function(App){return Ext.create("Rally.ui.grid.Grid",{store:App.centerGridStore,showPagingToolbar:!1,listeners:{load:function(myStore,myData,success){console.log("I'm here!")}},columnCfgs:[{text:"",dataIndex:"name"},{text:"",dataIndex:"data"}]})}});
                Ext.define("Chart",{_recordsToChartData:function(records){for(var dict={},i=0;records.length>i;i++){for(var exclusions=records[i].DaysInProgressExclusions,m=1,MAX=20;MAX>=5*m;){var multiple=5*m;if(multiple>=exclusions){var begin=5==multiple?0:multiple-4,name="Stories "+begin+" to "+multiple;this._populateDictionary(dict,multiple,name);break}m++}if(5*m>MAX){var name="More than "+MAX,index=MAX+1;this._populateDictionary(dict,index,name)}}var data=[];for(var prop in dict)data.push(dict[prop]);return data},_populateDictionary:function(dict,index,name){if(void 0==dict[index])dict[index]={name:name,data:1};else{var obj=dict[index];obj.data++}},_create:function(App){return Ext.create("Ext.chart.Chart",{renderTo:Ext.getBody(),width:500,height:350,animate:!0,store:App.chartStore,theme:"Base:gradients",legend:{visible:!0,position:"left",labelFont:"12px Arial"},series:[{type:"pie",angleField:"data",showInLegend:!0,tips:{trackMouse:!0,width:140,height:28,renderer:function(storeItem,item){var total=0;store.each(function(rec){total+=rec.get("data")}),this.setTitle(storeItem.get("name")+": "+Math.round(100*(storeItem.get("data")/total))+"%")}},highlight:{segment:{margin:20}},label:{field:"name",display:"rotate",contrast:!0,font:"12px Arial"}}]})}});
                Ext.define("MainGrid",{_create:function(App){return Ext.create("Rally.ui.grid.Grid",{store:App.customGridStore,columnCfgs:[{flex:1,text:"ID",dataIndex:"FormattedID"},{flex:1,text:"Name",dataIndex:"Name"},{flex:1,text:"Days In Progress",dataIndex:"DaysInProgress"},{flex:1,text:"Days In Progress (w/ Exclusions)",dataIndex:"DaysInProgressExclusions"},{flex:1,text:"In Progress Date",dataIndex:"InProgressDate"},{flex:1,text:"Accepted Date",dataIndex:"AcceptedDate"}]})}});
                Ext.define("MainStore",{_create:function(App,storeFilters){return Ext.create("Rally.data.wsapi.Store",{model:"User Story",autoLoad:!0,filters:storeFilters,listeners:{load:function(myStore,myData,success){var records=_.map(myData,function(record){function calculateDateDifference(record){var inProgressDate=record.get("InProgressDate"),acceptedDate=record.get("AcceptedDate"),oneDay=864e5,diffDays=Math.ceil(Math.abs((inProgressDate.getTime()-acceptedDate.getTime())/oneDay));return diffDays}function calculateExclusions(record,context){var field=Ext.getCmp("multiDateField"),inProgressDate=record.get("InProgressDate"),acceptedDate=record.get("AcceptedDate"),inProgressDateString=inProgressDate.getFullYear()+"-"+("0"+(inProgressDate.getMonth()+1)).slice(-2)+"-"+("0"+inProgressDate.getDate()).slice(-2),acceptedDateString=acceptedDate.getFullYear()+"-"+("0"+(acceptedDate.getMonth()+1)).slice(-2)+"-"+("0"+acceptedDate.getDate()).slice(-2),dateRange=inProgressDateString+"/"+acceptedDateString,dateArray=field.expandValues(dateRange,"Y-m-d",";","/"),excluded;if(context.checkboxValue){var weekendDays=_.filter(dateArray,function(date){var day=date.getDay();return 0==day||6==day}),weekendDayStrings=_.map(weekendDays,function(date){return""+date});excluded=_.uniq(_.union(weekendDayStrings,context.excludedDates))}else excluded=context.excludedDates;var dateStringArray=_.map(dateArray,function(date){return""+date}),intersection=_.intersection(dateStringArray,excluded),exclusions=calculateDateDifference(record)-intersection.length;return exclusions>=0?exclusions:0}return Ext.apply({DaysInProgress:calculateDateDifference(record),DaysInProgressExclusions:calculateExclusions(record,App)},record.getData())},App);App._loadGrid(myStore,records),App._createChart(records)},scope:App},fetch:["FormattedID","Name","AcceptedDate","InProgressDate","RevisionHistory","Revisions","Description","User","Project"]})}});
                Ext.require(["Ext.ux.form.field.MultiDate"]),Ext.define("MultiDateCalendarPanel",{_create:function(App){Ext.tip.QuickTipManager.init();var store;return Ext.create("Ext.form.Panel",{id:"formPanel",layout:"vbox",frame:!1,border:!1,defaults:{autoScroll:!0,bodyPadding:8,listeners:{specialkey:function(form,event){event.getKey()===event.ENTER&&form.up().down("#validateButton").handler()}}},items:[{xtype:"multidatefield",id:"multiDateField",fieldLabel:"Exclusions",allowBlank:!0,multiValue:!0,submitFormat:"Y-m-d",submitRangeSeparator:"/"},{xtype:"fieldcontainer",fieldLabel:"Exclude Weekends",defaultType:"checkboxfield",items:[{name:"weekendCheckbox",inputValue:"1",checked:!0,id:"weekendCheckbox"}]},{xtype:"button",id:"validateButton",text:"Get Report",scope:App,handler:function(){var form,field;if(form=Ext.getCmp("formPanel").getForm(),field=Ext.getCmp("multiDateField"),form.isValid()){var values=form.getValues(),valuesString=field.getSubmitValue(),valuesArray=field.expandValues(valuesString,"Y-m-d",";","/");App.checkboxValue=Ext.getCmp("weekendCheckbox").getValue(),App.excludedDates=_.map(valuesArray,function(date){return""+date}),App._runReport()}else console.log("The form is invalid."),App._runReport()}}],renderTo:Ext.getBody()})}});

            Rally.launchApp('CustomApp', {
                name:"exclusions",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
    <style type="text/css">
        .ux-datepicker-active{cursor:pointer;color:#000;background:repeat-x left top;background-color:#ddecfe}.ux-datepicker-inner,.ux-datepicker-inner td,.ux-datepicker-inner th{border-collapse:separate}table.ux-datepicker-inner{width:100%;table-layout:fixed}table.ux-datepicker-inner th{width:25px;height:19px;color:#233d6d;font:normal 10px tahoma,arial,verdana,sans-serif;text-align:right;border-bottom:1px solid #b2d1f5;border-collapse:separate;background-color:#dfecfb;background-image:linear-gradient(top, #edf4fd, #cde1f9);cursor:default;padding:0}table.ux-datepicker-inner th span{display:block;padding-right:7px}table.ux-datepicker-inner td{border:1px solid;height:17px;text-align:right;border-color:#FFF;padding:0}table.ux-datepicker-inner a{padding-right:4px;display:block;zoom:1;font:normal 11px tahoma,arial,verdana,sans-serif;color:#000;text-decoration:none;text-align:right}table.ux-datepicker-inner .ux-datepicker-active{cursor:pointer;color:#000;border:1px solid;border-color:#ff0000}table.ux-datepicker-inner .x-datepicker-selected a{background:repeat-x left top;background-color:#dae5f3;border:1px solid #8db2e3}table.ux-datepicker-inner .x-datepicker-selected span{font-weight:700}table.ux-datepicker-inner .x-datepicker-today a{border:1px solid;border-color:#8B0000}table.ux-datepicker-inner .x-datepicker-prevday a,table.ux-datepicker-inner .x-datepicker-nextday a{text-decoration:none!important;color:#aaa}table.ux-datepicker-inner a:hover,table.ux-datepicker-inner .x-datepicker-disabled a:hover{text-decoration:none!important}table.ux-datepicker-inner .u-datepicker-disabled a{cursor:default;background-color:#eee;color:#bbb}.x-item-disabled .ux-datepicker-inner a:hover{background:none}
    </style>
</head>
<body>
</body>
</html>
